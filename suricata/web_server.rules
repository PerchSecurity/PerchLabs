##    /$$$$$$    /$$$$$$$    /$$   /$$  ##
##   /$$__  $$  | $$__  $$  | $$  | $$  ##
##  | $$  \__/  | $$  \ $$  | $$  | $$  ##
##  | $$        | $$$$$$$/  | $$  | $$  ##
##  | $$        | $$__  $$  | $$  | $$  ##
##  | $$    $$  | $$  \ $$  | $$  | $$  ##
##  |  $$$$$$/  | $$  | $$  |  $$$$$$/  ##
##   \______/   |__/  |__/   \______/   ##

#--------------------------------#
#         Web App Ruleset        #
#--------------------------------#

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Possible Apache Struts 2 Forced OGNL Eval RCE Inbound (CVE-2020-17530)"; flow:established,to_server; http.method; content:"POST"; http.request_body; content:"|2e|InstanceManager"; nocase; content:"|2e|ValueStack"; distance:0; nocase; content:"|2e|BeanMap"; distance:0; nocase; content:"|2e|HashSet"; distance:0; nocase; content:"|2e|add|28|"; distance:0; nocase; content:"|2e|exec|28|"; distance:0; nocase; reference:url,https://github.com/wuzuowei/CVE-2020-17530; reference:cve,2020-17530; classtype:web-application-attack; sid:900219; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Potential Joomla ACL Handler Privilege Escalation CVE-2020-35616"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"administrator/index.php?option="; nocase; http.request_body; pcre:"/&jform\[rules\]\[core\.(create|delete|edit)\]\[\d+\]=1/"; tag:session,5,packets; reference:url, https://blog.securelayer7.net/latest-joomla-exploit-cve-2020-35616-acl-security-vulnerabilities/; reference:cve, 2020-35616; classtype:web-application-attack; metadata:created_at 2020_12_30, updated_at 2020_12_30; sid:900222; rev:1;)

alert http any any -> any any (msg:"[Perch Security] Possible VMware vCenter Unauthenticated Arbitrary File Read"; flow:established, to_server; http.method; content:"GET"; http.uri; pcre:"/\/eam\/vibd?\?id=/"; tag:session,5,packets; reference:url, https://github.com/jas502n/Vmware_vCenter; classtype:web-application-attack; sid:900223; rev:1; metadata:created_at 2021_01_05, updated_at 2021_01_05;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Possible Sharepoint Remote Code Execution CVE-2020-0646"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/_vti_bin/webpartpages.asmx"; nocase; http.host; content:".sharepoint.com"; http.request_body; content:"CallExternalMethodActivity|20|x|3a|Name|3d|"; nocase; content:"System|2e|Diagnostics|2e|Process|2e|Start|28 22|"; distance:0; nocase; tag:session,5,packets; reference:cve, 2020-0646; reference:url, https://www.mdsec.co.uk/2020/01/code-injection-in-workflows-leading-to-sharepoint-rce-cve-2020-0646/sid:900224; rev:1; metadata:created_at 2021_01_05, updated_at 2021_01_05;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Possible Apache Flink Directory Traversal (CVE-2020-17519)"; flow:established, to_server; http.method; content:"GET"; http.uri.raw; content:"/jobmanager/logs/..%252F..%252F"; nocase; fast_pattern; tag:session,5,packets; reference:url, https://github.com/B1anda0/CVE-2020-17519/blob/main/CVE-2020-17519.py; reference:cve, 2020-17519; classtype:attempted-admin; sid:900225; rev:1; metadata:created_at 2021_01_06, updated_at 2021_01_06;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Possible Apache Flink Upload Path Traversal (CVE-2020-17518)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/jars/upload"; nocase; fast_pattern; tag:session,5,packets; reference:url, https://github.com/vulhub/vulhub/tree/c339f4ddd977ff9a956350de4b1e6fb20b7b4415/flink/CVE-2020-17518; reference:cve, 2020-17518; classtype:web-application-attack; sid:900226; rev:1; metadata:created_at 2021_01_06, updated_at 2021_01_06;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Zend PHP Framework3 RCE (CVE-2021-3007)"; flow:established, to_server; http.method; content:"POST"; http.request_body; content:"WmVuZFxIdHRwXFJlc3BvbnNlXFN0cmVhbS"; content:"lplbmRcVmlld1xIZWxwZXJcR3JhdmF0YXI"; distance:0; content:"WmVuZFxWaWV3XFJlbmRlcmVyXFBocFJlbmRlcmVy"; distance:0; pcre:"/(?:FxDb25maWdcUmVhZGVyUGx1Z2luTWFuYWdlci|FxDb25maWdcQ29uZmln).+(?:JaZW5kXFZhbGlkYXRvclxDYWxsYmFjay|WmVuZFxWYWxpZGF0b3JcQ2FsbGJhY2s)/R"; tag:session,5,packets; classtype:web-application-attack; reference: url, github.com/Ling-Yizhou/zendframework3-; sid:900229; rev:1; metadata:created_at 2021_01_08, updated_at 2021_01_08, cve, CVE-2021-3007;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Potential Atlassian Jira Server/Data Center Unauthenticated Information Exposure (CVE-2020-14179)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/secure/QueryComponent!Default.jspa"; fast_pattern; tag:session,5,packets; classtype:web-application-attack; sid:900232; rev:1; metadata:created_at 2021_01_08, updated_at 2021_01_08;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Potential SAP EEM RCE (CVE-2020-6207)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/EemAdminService/EemAdmin"; http.request_body; pcre:"/:(?:getAgentInfo|getAllAgentInfo|setAgeletProperties|uploadResource|stopScript|deleteScript|setServerName).+(ProcessBuilder|getRuntime)?/i"; tag:session,5,packets; reference:url, github.com/chipik/SAP_EEM_CVE-2020-6207; sid:900233; rev:1; metadata: created_at 2021_01_15, updated_at 2021_01_15, cve CVE-2020-6207;)

alert http any any -> $HOME_NET any (msg:"[Perch Security] Potential Nagios XI 5.7.x Authenticated RCE"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/nagiosxi/admin/monitoringplugins.php"; http.request_body; content:"uploadedfile"; tag:session,5,packets; reference:url, https://www.exploit-db.com/exploits/49422; classtype:web-application-attack; sid:900234; rev:1; metadata: created_at 2021_01_17, updated_at 2021_01_17;)

alert http any any -> $HOME_NET any (msg:"[Perch Security] Potential Oracle Weblogic RCE (CVE-2021-2109)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/consolejndi.portal?"; http.request_body; content:"JNDIBindingPageGeneral"; distance:0; nocase; content:"JndiBindingHandle"; distance:0; nocase; content:"|3b|AdminServer"; distance:0; nocase; tag:session,5,packets; reference:url, twitter.com/jas502n/status/1352076921190850563; classtype:web-application-attack; sid:900235; rev:1; metadata: created_at 2021_01_21 updated_at 2021_01_21, cve CVE-2021-2109;)

alert http any any -> $HOME_NET any (msg:"[Perch Security] Potential Apache Druid Remote Code Execution (CVE-2021-25646)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/druid/"; http.request_body; content:"dataSchema"; content:"transformSpec"; distance:0; content:"javascript"; distance:0; nocase; content:"function("; distance:0; nocase; reference:url, https://gist.github.com/FanqXu/36c5e0070fd8e0b6646993b4e386a6b1; classtype:web-application-attack; sid:900236; rev:1; metadata: created_at 2021_02_02, updated_at 2021_02_02, cve CVE-2021-25646;)

alert http any any -> $HOME_NET any (msg:"[Perch Security] Potential Adobe Magento Commerce Reflected Cross-Site Scripting (XSS) (CVE-2021-21029)"; flow:established, to_server; http.method; content:"GET"; http.uri; pcre:"/\/admin\/system_design_theme\/downloadCss\/theme_id\/\d+\/file\/[a-zA-Z0-9%]+\/(key\/)?/"; reference:url, packetstormsecurity.com/files/161364/SA-20210210-0.txt; classtype:web-application-attack; sid:900238; rev:1; metadata: created_at 2021_02_12, updated_at 2021_02_12, cve CVE_2021_21029;)

# terramaster CVE-2020-15568
alert http any any -> $HOME_NET 5443 (msg:"[Perch Security] Potential TerraMaster OS Command Injection (CVE-2020-15568)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/include/exportUser.php?"; content:"type=3"; content:"cla=application"; content:"func=_exec"; content:"opt=("; reference:url, gist.github.com/pikpikcu/a7fcbc77ed2a7f45462d10420b1e68a9; classtype:web-application-attack; sid:900239; rev:1; metadata: created_at 2021_02_19, updated_at 2021_02_19, cve CVE_2020_15568;)

# vmware CVE-2021-21972
alert http any any -> [$HOME_NET,$HTTP_SERVERS] any (msg:"VMware vSphere Client Exploit Attempt (CVE-2021-21972)"; flow:established,to_server; content:"/ui/vropspluginui/rest/services/uploadova"; fast_pattern; http_uri; content:"POST"; http_method; reference:url,https://www.vmware.com/security/advisories/VMSA-2021-0002.html; reference:cve,2021-21972; classtype:web-application-attack; sid: 900261; metadata:created_at 2021_02_24, cve CVE_2021_21972, signature_severity Critical, updated_at 2021_02_24;)

# nagios ix CVE-2021-25299, CVE-2021-25298, CVE-2021-25297, CVE-2021-25296
alert http any any -> $HOME_NET any (msg:"[Perch Security] Nagios IX Command Injection (CVE-2021-25296)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/nagiosxi/config/monitoringwizard.php?"; pcre:"/plugin_output_len=\d+\;/Ui"; tag:session,5,packets; reference:url, packetstormsecurity.com/files/161561/nagiosxi575-exec.txt; classtype:web-application-attack; sid:900262; rev:1; metadata: created_at 02_26_2021, updated_at 02_26_2021, cve CVE_2021_25296;)
alert http any any -> $HOME_NET any (msg:"[Perch Security] Nagios IX Command Injection (CVE-2021-25297 & CVE-2021-25298)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/nagiosxi/config/monitoringwizard.php?"; content:"ip_address="; content:"|3b|"; within:16; tag:session,5,packets; reference:url, packetstormsecurity.com/files/161561/nagiosxi575-exec.txt; classtype:web-application-attack; sid:900263; rev:1; metadata: created_at 02_26_2021, updated_at 02_26_2021, cve CVE_2021_25297, cve CVE_2021_25297;)
alert http any any -> $HOME_NET any (msg:"[Perch Security] Nagios IX Command Injection (CVE-2021-25299)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/nagiosxi/admin/sshterm.php?"; content:"url="; nocase; pcre:"/url\x3d.+?(script|onmouse[a-z]+|onkey[a-z]+|onload|onunload|ondragdrop|onblur|onfocus|onclick|ondblclick|onsubmit|onreset|onselect|onchange|style\x3D)/Ri"; tag:session,5,packets; reference:url, packetstormsecurity.com/files/161561/nagiosxi575-exec.txt; classtype:web-application-attack; sid:900264; rev:1; metadata: created_at 02_26_2021, updated_at 02_26_2021, cve CVE_2021_25299;)

# Node.JS CVE-2021-21315
alert http any any -> $HOME_NET any (msg:"[Perch Security] Node.JS <5.3.1 Potential OS Command Injection (CVE-2021-21315)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/api/getServices?name|5b 5d|="; tag:session,5,packets; reference:url, github.com/ForbiddenProgrammer/CVE-2021-21315-PoC; classtype:web-application-attack; sid:900266; rev:1; metadata: created_at 2021_03_01, updated_at 2021_03_01, cve CVE_2021_21315;)

# vmware ssrf CVE-2021-21973
alert http any any -> $HOME_NET any (msg:"[Perch Security] VMWare vSphere Client Server-Side Request Forgery (CVE-2021-21973)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/ui/vropspluginui/rest/services/getvcdetails"; http.header; content:"vcIP|3a|"; tag:session,5,packets; reference:url, twitter.com/osama_hroot/status/1365586206982082560; classtype:web-application-attack; sid:900267; rev:1; metadata: created_at 2021_03_02, updated_at 2021_03_02, cve CVE_2021_211973;)

# saltstack CVE-2021-25281
alert http any any -> $HOME_NET any (msg:"[Perch Security] SaltStack <3002.5 SaltAPI Non eAuth wheel_async Access (CVE-2021-25281)"; http.method; content:"POST"; http.uri; content:"/run"; http.request_body; content:"\"eauth\": \"auto\""; content:"\"client\": \"wheel_async\""; content:"../"; distance:0; tag:session,5,packets; reference:url, github.com/Immersive-Labs-Sec/CVE-2021-25281; classtype:web-application-attack; sid:900268; rev:1; metadata: created_at 2021_03_02, updated_at 2021_03_02, cve CVE_2021_25281;)

# Exchange 2016 auth bypass & rce CVE-2021-26855
alert http any any -> $HOME_NET any (msg:"[Perch Security] Microsoft Exchange Authentication Bypass (CVE-2021-26855)"; http.method; content:"POST"; http.uri; pcre:"/\/owa\/auth\/Current\/themes\/resources\/[a-zA-Z0-9_-]+\.(css|gif|eot|ttf)/U"; tag:session,5,packets; reference:url, www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/; classtype:web-application-attack; sid:900269; rev:1; metadata: created_at 2021_03_02, updated_at 2021_03_02, cve CVE_2021_26855;)
alert http any any -> $HOME_NET any (msg:"[Perch Security] Microsoft Exchange Remote Code Execution (CVE-2021-26855)"; http.method; content:"POST"; http.uri; pcre:"/\/ecp\/(default\.flt|main.css|[a-z]\.js)/U"; tag:session,5,packets; reference:url, www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/; classtype:web-application-attack; sid:900270; rev:1; metadata: created_at 2021_03_02, updated_at 2021_03_02, cve CVE_2021_26855;)

# VMWare view planner cve-2021-21978
alert http $EXTERNAL_NET any -> $HOME_NET 443 (msg:"[Perch Security] Potential VMWare View Planner Unauthenticated RCE (CVE-2021-21978)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/loguploads?logMetaData="; content:"wsgi_log_upload"; distance:0; tag:session,3,packets; reference:url, twitter.com/osama_hroot/status/1367258907601698816; classtype:web-application-attack; sid:900272; rev:2; metadata: created_at 2021-03-04, updated_at 2021_03_04, cve CVE_2021_21978;)

# laravel cve-2021-3129
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Laravel Ignition Remote Code Execution (CVE-2021-3129)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/_ignition/execute-solution"; http.request_body; content:"Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution"; content:"viewFile"; distance:0; tag:session,5,packets; reference:url, github.com/SNCKER/CVE-2021-3129/blob/master/exploit.py; classtype:web-application-attack; sid:900273; rev:2; metadata: created_at 2021-03-04, updated_at 2021_03_04, cve CVE_2021_3129;)

# sportsball webshell
alert http any any -> $HOME_NET $HTTP_PORTS (msg:"[Perch Security] SPORTSBALL Webshell HTTP Cookie"; flow:established, to_server; http.method; content:"POST"; http.cookie; content:"fqrspt"; content:"ZN2aDAB4rXsszEvCLrzgcvQ4oi5J1TuiRULlQbYwldE="; distance:0; tag:session,5,packets; reference:url, www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/; classtype:web-application-attack; sid:900277; rev:1; metadata: created_at 2021_03_09, updated_at 2021_03_09, cve CVE_2021_26855;)

# FortiWeb CVE-2021-22122
alert http $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"[Perch Security] FortiWeb v6.3.x-6.2.x Unauthenticated XSS (CVE-2021-22122)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/error3?"; pcre:"/data='?\;/U"; tag:session,5,packets; reference:url, twitter.com/ptswarm/status/1357316793753362433; classtype:web-application-attack; sid:900281; rev:1; metadata: created_at 2021-03-10, updated_at 2021_03_10, cve CVE_2021_22122;)

# apache druid CVE-2021-25646
alert http $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"[Perch Security] Apache Druid Remote Code Execution (CVE-2021-25646)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/druid/indexer/v1/sampler?"; http.request_body; content:"javascript"; content:"exec("; distance:0; tag:session,5,packets; reference:url, paper.seebug.org/1476/; classtype:web-application-attack; sid:900282; rev:1; metadata: created_at 2021-03-10, updated_at 2021_03_10, cve CVE_2021_25646;)

# FortiLogger CVE-2021-3378
alert http $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"[Perch Security] FortiLogger Unauthenticated Arbitrary File Upload (CVE-2021-3378)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/Config/SaveUploadedHotspotLogoFile"; tag:session,5,packets; reference:url, erberkan.github.io/2021/cve-2021-3378/; classtype:web-application-attack; sid:900283; rev:1; metadata: created_at 2021-03-10, updated_at 2021_03_10, cve CVE_2021_3378;)

# dell openmanage CVE-2020-5377 & CVE-2021-21514
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Potential Dell OpenManage Administrator (OMSA) Authentication Bypass (CVE-2021-21514)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/LoginServlet?"; content:"flag=true"; content:"managedws=false"; http.request_body; content:"omsa"; nocase; content:"ignorecertificate"; nocase; tag:session,5,packets; reference:url, github.com/RhinoSecurityLabs/CVEs/blob/master/CVE-2020-5377_CVE-2021-21514/; classtype:web-application-attack; sid:900322; rev:1; metadata: created_at 2021_03_12, updated_at 2021_03_12, cve CVE_2020_5377;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Potential Dell OpenManage Administrator (OMSA) Arbitrary File Read (CVE-2020-5377)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/DownloadServlet?"; content:"app=oma"; content:"vid="; content:"file="; http.cookie; content:"JSESSONID="; tag:session,5,packets; reference:url, github.com/RhinoSecurityLabs/CVEs/blob/master/CVE-2020-5377_CVE-2021-21514/; classtype:web-application-attack; sid:900323; rev:1; metadata: created_at 2021_03_12, updated_at 2021_03_12, cve CVE_2020_5377;)

# rconfig lfi
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] rConfig 3.9.6 Local File Inclusion (Authenticated)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/lib/ajaxHandlers/ajaxGetFileByPath.php"; content:"path=|2e 2e 2f|"; distance:0; reference:url, packetstormsecurity.com/files/161775/rconfig396-lfi.txt; classtype:web-application-attack; sid:900324; rev:1; metadata: created_at 2021_03_15, updated_at 2021_03_15;)

# rconfig rce
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Potential rConfig Arbitrary File Upload"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/lib/crud/vendors.crud.php"; tag:session,5,packets; reference:url, packetstormsecurity.com/files/161852/rconfig396-shell.txt; classtype:web-application-attack; sid:900325; rev:1; metadata: created_at 2021_03_18, updated_at 2021_03_18;)

# fake flash Operation Diànxùn
alert http $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"[Perch Security] Fake Flash C2 (callback.php)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/callback.php?"; content:"token="; content:"computername="; content:"username="; http.user_agent; content:"Mozilla/5.0"; tag:session,3,packets; reference:url, mcafee.com/enterprise/en-us/assets/reports/rp-operation-dianxun.pdf; classtype:trojan-activity; sid:900326; rev:1; metadata: created_at 2021_03_22, updated_at 2021_03_22;)

# jira CVE-2020-14179
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Jira Server Information Disclosure (CVE-2020-14179)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/secure/QueryComponent!Default.jspa"; tag:session,3,packets; reference:url, twitter.com/JanmeyjaySharma/status/1374816812223762433; classtype:web-application-attack; sid:900327; rev:1; metadata: created_at 2021_03_24, updated_at 2021_03_24, cve CVE_2020_14179;)

# FortiLogger CVE-2021-3378
alert http $EXTERNAL_NET any -> $HOME_NET 5000 (msg:"[Perch Security] Potential FortiLogger <4.4.2.2 Arbitrary File Upload (CVE-2021-3378)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/Config/SaveUploadedHotspotLogoFile"; tag:session,5,packets; reference:url, erberkan.github.io/2021/cve-2021-3378/; classtype:web-application-attack; sid:900328; rev:1; metadata: created_at 2021_03_25, updated_at 2021_03_25, cve CVE_2021_3378;)

# vmware CVE-2021-21975
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] VMWare vRealize Operations Manager SSRF (CVE-2021-21975)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/casa/nodes/thumbprints"; fast_pattern; tag:session,3,packets; reference:url, github.com/Al1ex/CVE-2021-21975; classtype:web-application-attack; sid:900329; rev:1; metadata: created_at 2021_03_31, updated_at 2021_03_31, cve CVE_2021_21975;)

# revive CVE-2021-22873
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Revive Adserver < 5.1.0 Open Redirect (CVE-2021-22873)"; flow:established, to_server; http.method; content:"GET"; http.uri; pcre:"/(ads|adserve|adserver|openx|revive)?\/www\/delivery\/lg.php/U"; content:"dest="; distance:0; tag:session,3,packets; classtype:web-application-attack; sid:900330; rev:1; metadata: created_at 2021_03_31, updated_at 2021_03_31, cve CVE_2021_22873;)

# Apache OFBiz CVE-2021-26295
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Apache OFBiz Deserialization Arbitrary Code Execution (CVE-2021-26295)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/webtools/control/SOAPService"; http.content_type; content:"application/xml"; nocase; http.request_body; content:"<cus-obj>"; tag:session,5,packets; reference:url, github.com/yumusb/CVE-2021-26295-POC; classtype:web-application-attack; sid:900331; rev:1; metadata: created_at 2021_03_31, updated_at 2021_03_31, cve CVE_2021_26295;)

# Micro Focus CVE-2021-22502
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Micro Focus Operation Bridge Reporter (OBR) RCE (CVE-2021-22502)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/AdminService/urest/v1/LogonResource"; http.request_body; content:"|60|"; tag:session,5,packets; reference: url, github.com/pedrib/PoC/blob/master/advisories/Micro_Focus/Micro_Focus_OBR.md; classtype:web-application-attack; sid:900332; rev:1; metadata: created_at 2021_03_31, updated_at 2021_03_31, cve CVE_2021_22502;)

# openemr sqli
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] OpenEMR 4.1.0 'u' Parameter SQL Injection"; flow:established, to_server; http.uri; content:"/openemr/interface/login/validateUser.php"; content:"u="; distance:0; tag:session,5,packets; reference:url, packetstormsecurity.com/files/162074/openemr410-sql.txt; classtype:web-application-attack; sid:900335; rev:1; metadata: created_at 2021_04_05, updated_at 2021_04_05;)

# fireeye doubleback, doubledrag, doubledrop
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"[Perch Security] FireEye DOUBLEBACK C2 Traffic"; flow:established, to_server; http.uri; content:"client.php"; nocase; pcre:"/\/admin(4|5)?\/client\.php/Ui"; tag:session,5,packets; reference:url, www.fireeye.com/blog/threat-research/2021/05/unc2529-triple-double-trifecta-phishing-campaign.html; classtype:web-application-attack; sid:900338; rev:1; metadata: created_at 2021_05_10, updated_at 2021_05_10;)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"[Perch Security] FireEye DOUBLEDRAG Download Urls"; flow:established, to_server; http.uri; pcre:"/^\/(downld-id|files-upload|files|download|id|upld|zip_download|get_file-id)(_|-)[a-z]{7,16}\.(js|pdf|zip)$/Ui"; tag:session,5,packets; reference:url, www.fireeye.com/blog/threat-research/2021/05/unc2529-triple-double-trifecta-phishing-campaign.html; classtype:web-application-attack; sid:900339; rev:2; metadata: created_at 2021_05_10, updated_at 2021_05_10;)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"[Perch Security] FireEye DOUBLEDROP Download Urls"; flow:established, to_server; http.uri; pcre:"/\/(mini|update_java|ps1)\.dat/Ui"; tag:session,5,packets; reference:url, www.fireeye.com/blog/threat-research/2021/05/unc2529-triple-double-trifecta-phishing-campaign.html; classtype:web-application-attack; sid:900340; rev:1; metadata: created_at 2021_05_10, updated_at 2021_05_10;)

# magecart php in favicon
alert http $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"[Perch Security] HUNTING Magecart Hidden PHP in Favicons"; flow:established, to_client; http.content_type; content:"image/png"; http.response_body; content:"<?php"; tag:session,5,packets; classtype:web-application-attack; sid:900341; rev:1; metadata: created_at 2021_05_14, updated_at 2021_05_14;)

# jetty
alert http $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"[Perch Security] Possible Jetty Web Server Pre-Auth Information Disclosure (CVE-2021-28164)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"EB-INF/web.xml"; pcre:"/^\/(concat?\/\x2557|context\/\x2e\/W|concat?\/W)EB-INF\/web.xml$/Ui"; tag:session,5,packets; classtype:web-application-attack; sid:900342; rev:1; metadata: created_at 2021_06_14, updated_at 2021_06_14, cve CVE_2021_28164;)

# GLPI
alert http $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"[Perch Security] Possible GLPI Remote PHP Object Instantiation - getItemForItemtype (CVE-2021-21327)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/ajax/dropdownConnect.php"; http.request_body; content:"fromtype="; tag:session,5,packets; reference:url, iterasec.com/cve-2021-21327-unsafe-reflection-in-getitemforitemtype-in-glpi/; classtype:web-application-attack; sid:900343; rev:1; metadata: created_at 2021_06_14, updated_at 2021_06_14, cve CVE_2021_21327;)
alert http any $HTTP_PORTS -> $HOME_NET any (msg:"[Perch Security] GPLI Exposed Panels"; flow:established, to_client; http.stat_code; content:"200"; http.response_body; content:"<title>GLPI - "; content:"GLPI Copyright"; pcre:"/(Authentication|Аутентификация)/Q"; tag:session,5,packets; reference:url, www.exploit-db.com/ghdb/7002; classtype:web-application-attack; sid:900344; rev:1; metadata: created_at 2021_06_14, updated_at 2021_06_14;)

# ruby dragonfly CVE-2021-33564
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[Perch Security] Ruby Dragonfly Argument Injection (CVE-2021-33564)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/system"; content:"/images/W1si"; distance:0; pcre:"/\/images\/W1si(cC|Zy)IsICJjb252ZXJ0Ii/R"; tag:session,5,packets; reference:url, zxsecurity.co.nz/research/argunment-injection-ruby-dragonfly; classtype:web-application-attack; sid:900347; rev:1; metadata: created_at 2021_06_15, updated_at 2021_06_15, cve CVE_2021_33564;)

# openid 2fa bypass
alert http $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"[ConnectWise CRU] OpenID 2FA Misconfiguration Bypass"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/oauth/authorize?"; content:"acr_values=sms+password"; distance:0; tag:session,3,packets; reference:url, youst.in/posts/bypassing-2fa-using-openid-misconfiguration/; classtype:web-application-attack; sid:900348; rev:1; metadata: created_at 2021_06_18, updated_at 2021_06_18;)

# apache solr arbitrary file read
alert http $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"[ConnectWise CRU] Apache Solr <= 8.8.1 Arbitrary File Read"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/solr/"; startswith; content:"/debug/dump?"; distance:0; content:"stream.url=file:"; distance:0; tag:session,5,packets; classtype:web-application-attack; sid:900349; rev:1; metadata: created_at 2021_06_18, updated_at 2021_06_18;)

# magento file disclosure
alert http $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"[ConnectWise CRU] Magento Local File Disclosure"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/dev/tests/functional/"; pcre:"/\/dev\/tests\/functional\/(credentials|etc\/config)\.xml\.dist/UR"; tag:session,5,packets; classtype:web-application-attack; sid:900351; rev:1; metadata: created_at 2021_06_18, updated_at 2021_06_18;)

# oracle ebs bispgraph
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[ConnectWise CRU] Oracle EBS Bispgraph File Access"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/OA_HTML/"; startswith; content:"bispgraph.jsp"; distance:0; tag:session,5,packets; classtype:web-application-attack; sid:900352; rev:1; metadata: created_at 2021_06_18, updated_at 2021_06_18;)

# voip monitor rce CVE-2021-30461
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[ConnectWise CRU] Potential VOIP Monitor Remote Code Execution (CVE-2021-30461)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/index.php"; endswith; http.content_type; content:"application/x-www-form-urlencoded"; http.request_body; content:"SPOOLDIR"; content:"recheck"; distance:0; tag:session,5,packets; reference:url, github.com/Vulnmachines/CVE-2021-30461/blob/main/exploit.py; classtype:web-application-attack; sid:900353; rev:1; metadata: created_at 2021_06_18, updated_at 2021_06_18, cve CVE_2021_30461;)

# zoho CVE-2021-31159
alert http $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"[ConnectWise CRU] Zoho ManageEngine ServiceDesk Plus MSP - Active Directory User Enumeration (CVE-2021-31159)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"/ForgotPassword.sd?"; content:"userName="; distance:0; tag:session,5,packets; reference:url, github.com/ricardojoserf/CVE-2021-31159/blob/main/exploit.py; classtype:web-application-attack; sid:900354; rev:1; metadata: created_at 2021_06_18, updated_at 2021_06_18, cve CVE_2021_31159;)

# Cisco Modeling Labs (CVE-2021-1531)
alert http $EXTERNAL_NET any -> $HOME_NET [8082] (msg:"[ConnectWise CRU] Cisco Modeling Labs 2.1.1-b19 Post-Auth RCE (CVE-2021-1531)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/api/v0/images/upload"; http.header; content:"X-Original-File-Name|3a 20|"; pcre:"/^[\w\-\.]+(\x27\x3b)/Ri"; tag:session,5,packets; reference:url, packetstormsecurity.com/files/163265/ciscoml211b19-exec.txt; classtype:web-application-activity; sid:900357; rev:1; metadata: created_at 2021_06_24, updated_at 2021_06_24, cve CVE_2021_1531;)

# pega infinity CVE-2021-27651
alert http $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"[ConnectWise CRU] Pega Infinity Password Recovery Improper Authentication (CVE-2021-27651)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/prweb/PRServlet/"; nocase; startswith; pcre:"/[a-zA-Z0-9_]{32}\*?\/!STANDARD/U"; http.request_body; content:"pzAuth="; content:"NewPassword="; content:"ChangeUserPassword="; tag:session,5,packets; reference:url, github.com/samwcyo/CVE-2021-27651-PoC/blob/main/RCE.md; classtype:web-application-activity; sid:900358; rev:1; metadata: created_at 2021_06_25, updated_at 2021_06_25, cve CVE_2021_27651;)

# gitlab CVE-2021-22214
alert http $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"[ConnectWise CRU] Possible Gitlab CI Lint API Unauthorized SSRF (CVE-2021-22214)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/api/v4/ci/lint"; startswith; http.content_type; content:"application/json"; http.request_body; content:"remote: http://"; tag:session,5,packets; reference:url, github.com/r0ckysec/CVE-2021-22214; classtype:web-application-activity; sid:900359; rev:1; metadata: created_at 2021_06_25, updated_at 2021_06_25, cve CVE_2021_22214;)

# cisco asa CVE-2020-3580
alert http $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"[ConnectWise CRU] Cisco ASA Cross-Site Scripting (CVE-2020-3580)"; flow:established, to_server; http.method; content:"POST"; http.uri; content:"/+CSCOE+/saml/sp/acs"; content:"tgname="; distance:0; http.content_type; content:"application/x-www-form-urlencoded"; http.request_body; content:"SAMLResponse="; content:"alert|28|"; distance:0; tag:session,5,packets; reference:url, twitter.com/ptswarm/status/1408050644460650502; sid:900360; rev:1; metadata: created_at 2021_06_25, updated_at 2021_06_25, cve CVE_2020_3580;)

# VMWare ESXi OpenSLP CVE-2021-21974
alert tcp $EXTERNAL_NET any -> $HOME_NET 427 (msg:"[ConnectWise CRU] VMWare ESXi OpenSLP Suspicious Directory Agent Advertisement (CVE-2021-21974)"; content:"|02 08|"; startswith; content:"|00 00|"; distance:14; content:"|41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41|"; distance:6; content:":/"; distance:2; tag:session,10,packets; reference:url, straightblast.medium.com/my-poc-walkthrough-for-cve-2021-21974-a266bcad14b9; classtype:attempted-user; sid:900361; rev:1; metadata: created_at 2021_06_25, updated_at 2021_06_25;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 427 (msg:"[ConnectWise CRU] VMWare ESXi OpenSLP Multiple Service Request (CVE-2021-21974)"; content:"|02 01|"; startswith; content:"|00 00|"; distance:14; threshold: type threshold, track by_src, count 5, seconds 15; reference:url, straightblast.medium.com/my-poc-walkthrough-for-cve-2021-21974-a266bcad14b9; classtype:attempted-user; sid:900362; rev:1; metadata: created_at 2021_06_25, updated_at 2021_06_25;)

# Atlassian Reflected XSS (CVE-2021-26078)
alert http $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"[ConnectWise CRU] Atlassian Jira Reflected Cross-Site Scripting (CVE-2021-26078)"; flow:established, to_server; http.method; content:"GET"; http.uri; content:"jql=issuetype"; content:"alert|28|"; distance:0; tag:session,5,packets; reference:url, www.exploit-db.com/exploits/50068; classtype:web-application-attack; sid:900363; rev:1; metadata: created_at 2021_06_28, updated_at 2021_06_28 cve CVE_2021_26078;)

# tracking Kaseya (cve-2021-30116)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[ConnectWise CRU] Potential Kaseya VSA SQLi (CVE-2021-30116)"; http.method; content:"POST"; http.uri; content:"/userFilterTableRpt.asp"; endswith; nocase; tag:session,5,packets; reference:url, www.huntress.com/blog/rapid-response-kaseya-vsa-mass-msp-ransomware-incident; classtype:web-application-attack; sid:900374; rev:1; metadata: created_at 2021_07_04, updated_at 2021_07_04;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[ConnectWise CRU] Potential Kaseya VSA Authentication Bypass (CVE-2021-30116)"; http.method; content:"POST"; http.uri; content:"/dl.asp"; endswith; nocase; tag:session,5,packets; reference:url, www.huntress.com/blog/rapid-response-kaseya-vsa-mass-msp-ransomware-incident; classtype:web-application-attack; sid:900375; rev:1; metadata: created_at 2021_07_04, updated_at 2021_07_04;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"[ConnectWise CRU] Potential Kaseya VSA Upload (CVE-2021-30116)"; http.method; content:"POST"; http.uri; content:"/KUpload.dll"; endswith; nocase; tag:session,5,packets; reference:url, www.huntress.com/blog/rapid-response-kaseya-vsa-mass-msp-ransomware-incident; classtype:web-application-attack; sid:900376; rev:1; metadata: created_at 2021_07_04, updated_at 2021_07_04;)
